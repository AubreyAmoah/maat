<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAAT</title>
    <link rel="stylesheet" href="style.css" />
    <script
      src="https://kit.fontawesome.com/d4fd77631c.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="container">
      <button id="microphone" class="microphone">
        <i class="fa-solid fa-microphone"></i>
      </button>
      <div class="hints"></div>
      <p id="intro">
        Hello, My name is Elsah, and I'm your A.I mathematics assistant.
      </p>

      <div class="page">
        <h1>Speech Settings</h1>

        <p>Fine tune the settings below for your desirable effect</p>

        <form>
          <input type="text" class="txt" />
          <div>
            <label for="rate">Rate</label
            ><input
              type="range"
              min="0.5"
              max="2"
              value="1"
              step="0.1"
              id="rate"
            />
            <div class="rate-value">1</div>
            <div class="clearfix"></div>
          </div>
          <div>
            <label for="pitch">Pitch</label
            ><input
              type="range"
              min="0"
              max="2"
              value="1"
              step="0.1"
              id="pitch"
            />
            <div class="pitch-value">1</div>
            <div class="clearfix"></div>
          </div>
          <select></select>
        </form>
      </div>
    </div>
  </body>
  <script>
    const synth = window.speechSynthesis;
    const intro = document.getElementById("intro");
    const inputForm = document.querySelector("form");
    const inputTxt = document.querySelector(".txt");
    const voiceSelect = document.querySelector("select");

    const pitch = document.querySelector("#pitch");
    const pitchValue = document.querySelector(".pitch-value");
    const rate = document.querySelector("#rate");
    const rateValue = document.querySelector(".rate-value");

    let voices = [];

    function populateVoiceList() {
      voices = synth.getVoices();

      for (const voice of voices) {
        const option = document.createElement("option");
        option.textContent = `${voice.name} (${voice.lang})`;

        if (voice.default) {
          option.textContent += " â€” DEFAULT";
        }

        option.setAttribute("data-lang", voice.lang);
        option.setAttribute("data-name", voice.name);
        voiceSelect.appendChild(option);
      }
    }

    function speakIntro() {
      const utterThis = new SpeechSynthesisUtterance(intro.innerText);
      const selectedOption = voiceSelect.selectedOptions[0]?.getAttribute("data-name");

      if (selectedOption) {
        for (const voice of voices) {
          if (voice.name === selectedOption) {
            utterThis.voice = voice;
          }
        }
      }

      utterThis.pitch = pitch.value;
      utterThis.rate = rate.value;
      synth.speak(utterThis);
      utterThis.onpause = (event) => {
        const char = event.utterance.text.charAt(event.charIndex);
        console.log(
          `Speech paused at character ${event.charIndex} of "${event.utterance.text}", which is "${char}".`
        );
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateVoiceList();
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
      }
      speakIntro();
    });

    pitch.onchange = () => {
      pitchValue.textContent = pitch.value;
    };

    rate.onchange = () => {
      rateValue.textContent = rate.value;
    };
  </script>
</html>
